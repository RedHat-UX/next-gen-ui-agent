# Next Gen UI MCP Apps UI

TypeScript/React UI module for rendering MCP tool results using PatternFly components via the MCP Apps SDK.

## Overview

This module contains the browser-based UI views that render component configurations generated by the `next_gen_ui_mcp` Python server. It uses:

- **MCP Apps SDK** - Framework for creating MCP App views
- **React** - UI framework
- **@rhngui/patternfly-react-renderer** - DynamicComponent library for rendering PatternFly components
- **Vite** - Build tool with single-file bundling

## Architecture

```
Python MCP Server → UIBlock (component config) → MCP Host → HTML View (this module) → DynamicComponent
```

The views receive tool results containing `UIBlock[]` where each block has:
- `rendering.content` - JSON string of component configuration
- Component configs are parsed and passed to `DynamicComponent`

## Quick Start

### Prerequisites

- Node.js 20+ installed
- Python 3.12+ installed
- Pants build system configured (from project root)

### Quick Commands

**Build UI Resources (All-in-One):**

```bash
# From project root
cd /path/to/next-gen-ui-agent

# Install deps, build, and copy to Python module
pants run libs/next_gen_ui_mcp:update-ui
```

**Or Step-by-Step:**

```bash
# From project root
cd libs/next_gen_ui_mcp_apps_ui
npm install
npm run build

# Copy to Python module
cp dist/*.html ../next_gen_ui_mcp/ui_resources/
```

## Project Structure

```
libs/next_gen_ui_mcp_apps_ui/
├── package.json              # Dependencies and build scripts
├── tsconfig.json             # TypeScript configuration
├── vite.config.ts            # Vite bundler configuration
├── mcp-app.html             # HTML entry point
├── src/
│   ├── shared/
│   │   ├── types.ts         # TypeScript interfaces (UIBlock, MCPGenerateUIOutput, etc.)
│   │   ├── hooks.ts         # useToolResultParser() custom React hook
│   │   ├── components.tsx   # Shared components (ErrorDisplay, LoadingDisplay, ComponentRenderer)
│   │   └── App.tsx          # Main unified App component with auto-spacing logic
│   └── mcp-app.tsx          # Main entry point (~5 lines)
└── dist/                     # Build output (gitignored)
    └── mcp-app.html         # Self-contained ~1.3MB HTML file
```

## Shared Modules

### `src/shared/types.ts`
Defines TypeScript interfaces for:
- `UIBlock` - Server-generated UI block structure
- `MCPGenerateUIOutput` - Tool result format
- `ToolResult` - MCP tool result wrapper

### `src/shared/hooks.ts`
**`useToolResultParser()`** - Custom React hook that:
1. Receives `app.toolResult` from MCP Apps SDK
2. Parses `structured_content` or JSON text content
3. Extracts component configs from `UIBlock.rendering.content`
4. Returns `{ componentConfigs, error, isLoading }`

### `src/shared/components.tsx`
Reusable React components:
- **`ErrorDisplay`** - Shows error messages
- **`LoadingDisplay`** - Shows loading states
- **`ComponentRenderer`** - Maps configs to `DynamicComponent` instances

### `src/shared/App.tsx`
Main unified component that:
1. Uses `useApp()` hook to connect to MCP Apps SDK
2. Parses tool results via `useToolResultParser()`
3. Handles loading, error, and success states
4. **Auto-enables spacing** when rendering multiple components (`componentConfigs.length > 1`)
5. Triggers resize detection after content renders

## Building

### Prerequisites

```bash
# Install dependencies (one time)
npm install
```

### Build Commands

```bash
# Build the HTML file
npm run build

# Watch mode (auto-rebuild on changes)
npm run watch
```

### Using Pants

```bash
# Build via Pants (from project root)
cd /path/to/next-gen-ui-agent
pants run libs/next_gen_ui_mcp_apps_ui:build
```

## Development

### Development Mode Workflow

Run these commands in separate terminals for live development:

```bash
# Terminal 1: Watch UI changes (auto-rebuild)
cd libs/next_gen_ui_mcp_apps_ui
npm run watch

# Terminal 2: Run MCP server
cd /path/to/next-gen-ui-agent
pants run libs/next_gen_ui_mcp/server_example.py

# Terminal 3: When UI changes, update resources
pants run libs/next_gen_ui_mcp:update-ui
```

### Local Development with next-gen-ui-react

To use a local version of `@rhngui/patternfly-react-renderer` during development:

**Option 1: npm link**
```bash
# In next-gen-ui-react directory
cd /path/to/next-gen-ui-react
npm run build
npm link

# In this directory
npm link @rhngui/patternfly-react-renderer
```

**Option 2: File path**
```json
{
  "dependencies": {
    "@rhngui/patternfly-react-renderer": "file:../../next-gen-ui-react"
  }
}
```

## Build Output

The build process creates a **self-contained HTML file** (~1.3MB) with:
- All React code inlined
- All PatternFly components bundled
- All CSS inlined
- No external dependencies

This file can be served directly by the MCP server as a resource.

## Component View

### Main Entry Point (`mcp-app.tsx`)

Single unified entry point that handles both single and multiple component rendering:

```tsx
import ReactDOM from "react-dom/client";
import { App } from "./shared/App";

ReactDOM.createRoot(document.getElementById("root")!).render(
  <App appName="Next Gen UI" />
);
```

### Auto-Spacing Logic

The `App` component automatically enables spacing between components when rendering more than one:
```tsx
<ComponentRenderer 
  configs={componentConfigs} 
  spacing={componentConfigs.length > 1} 
/>
```

This means the same UI can handle any number of components - whether you have 1 or 100 components, the appropriate spacing is applied automatically.

## Data Flow

```
1. MCP Server generates UIBlock with rendering.content = '{"component":"data-view","fields":[...]}'
2. Python returns MCPGenerateUIOutput with blocks: [UIBlock, ...]
3. MCP Host reads ui://generate_ui_component/mcp-app.html resource and loads HTML in iframe
4. React app initializes with MCP Apps SDK
5. useToolResultParser() parses app.toolResult
6. Extracts component configs from blocks[].rendering.content
7. ComponentRenderer passes each config to DynamicComponent
8. DynamicComponent renders PatternFly components (with auto-spacing if multiple)
```

## Testing the Integration

### 1. Start the MCP Server

```bash
# With SSE transport (for testing)
pants run libs/next_gen_ui_mcp/server_example.py -- --transport sse --port 3001

# With stdio transport (for Claude Desktop)
pants run libs/next_gen_ui_mcp/server_example.py -- --transport stdio
```

### 2. Connect an MCP Host

**Option A: Claude Desktop**

Add to Claude Desktop config (`~/Library/Application Support/Claude/claude_desktop_config.json`):
```json
{
  "mcpServers": {
    "next-gen-ui": {
      "command": "pants",
      "args": ["run", "libs/next_gen_ui_mcp/server_example.py", "--", "--transport", "stdio"],
      "cwd": "/path/to/next-gen-ui-agent"
    }
  }
}
```

**Option B: Basic Host (for testing)**

Use the [example host](https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/basic-host) from `mcp-ext-apps`:
```bash
cd /path/to/mcp-ext-apps/examples/basic-host
npm install
npm run dev
```

Note: Check the instructions from this host if you want to run your server on a different port, as it requires setting environment variables.

### 3. Test Tool Calls

In your MCP host, execute the `generate_ui_component` tool with:

```json
{
  "user_prompt": "Tell me brief details of Toy Story in a form of a card with image",
  "data": "{\"toy_story\":{\"languages\":[\"English\"],\"year\":1995,\"imdbId\":\"0114709\",\"runtime\":81,\"imdbRating\":8.3,\"movieId\":\"1\",\"countries\":[\"USA\"],\"imdbVotes\":591836,\"title\":\"Toy Story\",\"url\":\"https://themoviedb.org/movie/862\",\"revenue\":373554033,\"tmdbId\":\"862\",\"plot\":\"A cowboy doll is profoundly threatened and jealous when a new spaceman figure supplants him as top toy in a boy's room.\",\"posterUrl\":\"https://image.tmdb.org/t/p/w440_and_h660_face/uXDfjJbdP4ijW5hWSBrPrlKpxab.jpg\",\"released\":\"1995-11-22\",\"trailerUrl\":\"https://www.youtube.com/watch?v=v-PjgYDrg70\",\"budget\":30000000,\"actors\":[\"Jim Varney\",\"Tim Allen\",\"Tom Hanks\",\"Don Rickles\"],\"genres\":[\"Animation\",\"Adventure\",\"Family\",\"Comedy\"],\"director\":\"John Lasseter\",\"productionCompany\":\"Pixar Animation Studios\",\"openingWeekend\":29140617,\"domesticRevenue\":191796233,\"internationalRevenue\":181757800,\"profit\":343554033,\"roi\":11.45,\"audienceScore\":92,\"criticScore\":100,\"awards\":{\"wins\":28,\"nominations\":24,\"oscars\":1},\"weeklyBoxOffice\":[{\"week\":1,\"revenue\":29140617},{\"week\":2,\"revenue\":18923456},{\"week\":3,\"revenue\":15234567},{\"week\":4,\"revenue\":12345678}]}}",
  "data_type": "movie_detail",
  "data_id": "external_test_id"
}
```

You should see the UI render in an iframe!

## Troubleshooting

### Build fails with "cross-env: command not found"

Run `npm install` to install dependencies.

### Empty output or "Loading..."

Check that:
1. Tool result contains `blocks` array
2. Each block has `rendering.content` as JSON string
3. JSON is valid and parseable

### Components not rendering

Verify component configs match DynamicComponent expected format:
- `component` field specifies component type
- Required props for that component type are present

### PatternFly styles missing

All PatternFly CSS is bundled inline. If styles are missing, rebuild:
```bash
npm run build
```

## Dependencies

### Runtime
- `@modelcontextprotocol/ext-apps` - MCP Apps SDK
- `@rhngui/patternfly-react-renderer` - DynamicComponent library
- `react` / `react-dom` - React framework
- `victory-legend` - Peer dependency for charts

### Build
- `typescript` - TypeScript compiler
- `vite` - Build tool
- `@vitejs/plugin-react` - React plugin for Vite
- `vite-plugin-singlefile` - Bundles everything into single HTML file
- `cross-env` - Cross-platform environment variables
- `concurrently` - Run multiple build tasks

## Related Documentation

- [MCP Apps Specification](../../specification/2026-01-26/apps.mdx)
- [next-gen-ui-react Library](https://github.com/RedHat-UX/next-gen-ui-react)
- [Python MCP Server](../next_gen_ui_mcp/README.md)
